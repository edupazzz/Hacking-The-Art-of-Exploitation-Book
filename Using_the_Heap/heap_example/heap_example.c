#include <stdio.h>
#include <stdlib.h>
#include <string.h>

int main(int argc, char *argv[])
{
  char *char_ptr; // Um ponteiro Char
  int *int_ptr;   // Um ponteiro Int
  int mem_size;

  if(argc < 2) // Se nao houver args na linha de comand
  {
    mem_size = 50; // usamos 50 como valor padrao
  }else{
    mem_size = atoi(argv[1]); 
   }

  printf("\t[+] allocating %d bytes of memory on the heap for char_ptr\n", mem_size);
  char_ptr = (char *) malloc(50); // Alocando memoria da heap

  if(char_ptr == NULL) // No caso de dar algum erro
  {
    fprintf(stderr, "Error: could not allocate heap memory.\n");
    exit(-1);
  } 

  strcpy(char_ptr, "This memory is located on the heap.");
  printf("char_ptr (%p) --> '%s'\n", char_ptr, char_ptr);

  printf("\t[+] allocating 12 bytes of memory on the heap for int_ptr\n");
  int_ptr = (int *) malloc(12); // Alocando memoria heap denovo..

  if(int_ptr == NULL)
  {
    fprintf(stderr,"Error: could not allocate heap memory.\n");
    exit(-1);
  }

  *int_ptr = 31337; // Put the value of 31337 where int_ptr is pointing.
  printf("int_ptr (%p) --> %d\n", int_ptr, *int_ptr);

  printf("\t [-] freeing char_ptr's heap memory...\n");
  free(char_ptr); // Liberando heap memory

  printf("\t[+] allocating another 15 bytes for char_ptr\n"); 
  char_ptr = (char *) malloc(15); // Alocando heap memory

  if(char_ptr == NULL)
  {
    fprintf(stderr, "Error: could not allocate heap memory. \n");
    exit(-1);
  }

  strcpy(char_ptr, "new memory");
  printf("char_ptr (%p) --> '%s'\n", char_ptr, char_ptr);

  printf("\t[-] freeing int_ptr's heap memory...\n");
  free(int_ptr);
 
  printf("\t[-] freeing char_ptr's memory");
  free(char_ptr);
}
